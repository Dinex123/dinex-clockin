<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Resetear Contraseña</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .contenedor {
      max-width: 420px;
      margin: 0 auto;
      padding: 24px 18px;
      text-align: center;
    }
    .logo {
      max-width: 200px;
      display: block;
      margin: 0 auto 16px auto;
    }
    h1 {
      color: #85b100;
      margin-bottom: 18px;
      font-size: 22px;
    }
    .campo {
      margin: 10px 0;
      text-align: left;
    }
    .campo label {
      display: block;
      font-weight: 600;
      margin-bottom: 6px;
    }
    .campo input {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
      box-sizing: border-box;
    }
    .boton {
      background-color: #ec008c;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      margin-top: 8px;
      width: 100%;
    }
    .boton:hover { background-color: #c60074; }
    .mensaje {
      margin-top: 10px;
      font-weight: 600;
    }
    .acciones {
      margin-top: 14px;
    }
    .acciones a {
      display: inline-block;
      margin-top: 8px;
      text-decoration: none;
      color: #ec008c;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="contenedor">
    <img src="logo-dinex.png" alt="Logo DinEX" class="logo" />
    <h1>Resetear Contraseña</h1>

    <form id="resetForm" onsubmit="event.preventDefault(); resetear();">
      <div class="campo">
        <label for="usuario">Usuario</label>
        <input type="text" id="usuario" placeholder="Usuario (username)" required />
      </div>

      <div class="campo">
        <label for="nuevaClave">Nueva contraseña</label>
        <input type="password" id="nuevaClave" placeholder="Nueva contraseña" required />
      </div>

      <div class="campo">
        <label for="confirmarClave">Confirmar contraseña</label>
        <input type="password" id="confirmarClave" placeholder="Confirmar contraseña" required />
      </div>

      <button type="submit" id="btnEnviar" class="boton">Guardar nueva contraseña</button>
      <div id="msg" class="mensaje"></div>
    </form>

    <div class="acciones">
      <a href="empleados.html">Volver a Empleados</a> ·
      <a href="admin.html">Volver al Panel</a>
    </div>
  </div>

  <script>
    async function resetear() {
      const usuario       = document.getElementById('usuario').value.trim();
      const nuevaClave    = document.getElementById('nuevaClave').value;
      const confirmarClave= document.getElementById('confirmarClave').value;
      const btn           = document.getElementById('btnEnviar');
      const msg           = document.getElementById('msg');

      msg.textContent = '';
      msg.style.color = '';

      if (!usuario || !nuevaClave || !confirmarClave) {
        msg.textContent = 'Completa todos los campos.';
        msg.style.color = 'red';
        return;
      }
      if (nuevaClave !== confirmarClave) {
        msg.textContent = 'Las contraseñas no coinciden.';
        msg.style.color = 'red';
        return;
      }

      try {
        btn.disabled = true;
        btn.textContent = 'Guardando…';

        // Si tienes common.js con postJSON, puedes reemplazar por:
        // const resp = await postJSON('/api/reset-password-admin', { usuario, nuevaClave });

        const respRaw = await fetch('/api/reset-password-admin', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ usuario, nuevaClave })
        });
        const resp = await respRaw.json();

        if (resp.success) {
          msg.textContent = '✔ Contraseña actualizada correctamente.';
          msg.style.color = 'green';
          // Limpia campos
          document.getElementById('nuevaClave').value = '';
          document.getElementById('confirmarClave').value = '';
        } else {
          msg.textContent = resp.message || '❌ No se pudo actualizar la contraseña.';
          msg.style.color = 'red';
        }
      } catch (e) {
        console.error(e);
        msg.textContent = '❌ Error de conexión con el servidor.';
        msg.style.color = 'red';
      } finally {
        btn.disabled = false;
        btn.textContent = 'Guardar nueva contraseña';
      }
    }
  </script>

  <!-- Si usas helpers globales, descomenta esta línea: -->
  <!-- <script src="common.js"></script> -->
</body>
</html>